% xModelComparisons.m

% Comparing the results of Fabber ModelFits (simulated data)

% MT Cherukara
% 6 December 2018

% Actively used as of 2019-01-31


clear;
close all;

setFigureDefaults;


% Select the rows we want to plot
plotrows = [8,5,6,7];


%% Comparisons of SNR Levels (R2p model, 2C simulation)

% Row Names
rnames = {'L Model'     ; ...   % 1 - L model, 11 tau values
          '1C Model'    ; ...   % 2 - 1C model, 11 tau values
          '11 taus'     ; ...   % 3 - 2C model, 11 tau values
          '11\tau ( -16:8:64 )' ; ...   % 4 - 2C model, 11 taus
          '7\tau ( 0:10:60 )'   ; ...   % 5 - 2C model, 7 taus (long)
          '7\tau ( 0:6:36 )'    ; ...   % 6 - 2C model, 7 taus (short)
          '7\tau, TE=50ms'      ; ...   % 7 - 2C model, 7 taus, TE=50
          '11\tau ( -16:8:64 )' ; ...   % 8 - 2C model, 9 taus
         };
     
% SNR values
SNR = [ 5, 10, 25, 50, 100, 200, 500 ];

% SNR         5         10         25         50        100        200        500
Err_OEF = [ 145.0000,  200.0000,  200.0000,   54.6000,   32.8000,   22.3000,   15.6000; ...
             40.7000,   44.3000,   42.8000,   38.0000,   30.2000,   22.8000,   21.1000; ...
             40.7000,   51.2000,   45.9000,   36.8000,   24.2000,   17.9000,   17.2000; ...
            147.0000,  144.0000,  136.0000,   94.4000,   99.9000,   83.9000,   75.1000; ...
            133.0000,  133.0000,  123.0000,  137.0000,  130.0000,  119.0000,  118.0000; ...
             98.3000,  118.0000,  138.0000,  124.0000,  130.0000,  124.0000,  139.0000; ...
            116.0000,  156.0000,  110.0000,  105.0000,   80.5000,   84.9000,   77.3000; ...
            126.0000,  148.0000,  125.0000,  107.0000,   91.9000,   91.1000,   90.1000 ];

% SNR         5         10         25         50        100        200        500
Err_DBV = [  24.1000,    8.6200,    3.6900,    2.0100,    1.1000,    0.6400,    0.4100; ...
             60.9000,   13.0000,    6.0700,    3.0600,    1.9400,    1.3900,    1.1600; ...
             19.8000,   11.2000,    6.0100,    3.7000,    2.1000,    1.2500,    1.0700; ...
            100.0000,  100.0000,   17.2000,   16.5000,   14.2000,   14.8000,   15.1000; ...
             23.4000,   14.1000,    6.6700,    4.4000,    3.5700,    3.1900,    3.0600; ...
             29.2000,   18.3000,    9.3800,    6.2700,    4.5700,    3.8100,    3.5300; ...
             29.3000,   18.3000,    9.4100,    6.1800,    4.2300,    3.2700,    2.8200; ...
             31.0000,   19.9000,    8.0300,    4.7700,    3.5400,    3.6300,    2.6600 ];

% SNR         5         10         25         50        100        200        500
Err_R2p = [   8.8700,    3.0800,    2.1600,    1.9800,    1.9500,    1.9400,    1.9500; ...
              7.5500,    4.1900,    2.5300,    2.3000,    2.2700,    2.2800,    2.3700; ...
              5.7300,    3.5400,    2.7700,    2.3400,    2.1000,    1.9500,    2.2200; ...
             11.1000,    9.8700,    6.5700,    6.7500,    7.0800,    7.2200,    7.4900; ...
              6.8500,    4.2300,    2.7700,    2.3200,    2.1200,    2.0200,    1.9600; ...
             10.1000,    6.8400,    4.0600,    3.7200,    3.1300,    2.6800,    2.5900; ...
              9.9200,    6.6100,    4.1600,    3.7400,    3.6500,    3.5000,    3.4900; ...
              9.0000,    6.3600,    2.8600,    1.9700,    1.5600,    1.5300,    1.4600 ];

% SNR         5         10         25         50        100        200        500
Rel_All = [ 613.2000,  851.9000,  569.5000,  221.3000,  122.7000,   86.2000,   62.5000; ...
            749.9000,  560.1000,  316.2000,  196.2000,  125.5000,   89.8000,   81.2000; ...
            734.2000,  578.2000,  358.3000,  245.8000,  124.9000,   89.4000,   76.6000 ];

%% Data for Comparisons across SNR levels - OLD!!!
% 
% rnames = {'Linear Model'      ; ...     % 1
%           'L Model' ; ...     % 2
%           '1C Model'          ; ...     % 3
%           '2C Model'          ; ...     % 4
%           '1C Model'          ; ...     % 5 - Certain
%           '2C Model'          ; ...     % 6 - Certain
%           '1C Model'            ; ...     % 7 - OEF Model
%           '2C Model'             };       % 8 - OEF Model
      
% % Data for 1C model
% SNR  = [  5    ,  10    ,  25    , 50     , 100    , 200     , 500     ];
% 
% % SNR         5          10         25         50         100        200        500
% Err_OEF = [ 100.0000,  100.0000,  100.0000,   75.6000,  100.0000,   26.9000,   17.0000; ...
%             100.0000,  100.0000,  100.0000,   54.6000,   32.8000,   22.3000,   15.6000; ...
%              71.3000,   69.3000,   51.3000,   41.7000,   36.6000,   34.0000,   34.0000; ...
%              79.5000,   66.4000,   46.3000,   34.4000,   28.1000,   26.0000,   25.6000; ...
%             100.0000,   81.2000,   52.4000,   41.7000,   35.5000,   32.4000,   32.3000; ...
%             100.0000,   70.8000,   46.7000,   32.7000,   25.3000,   22.6000,   21.9000; ...
%             100.0000,   77.3000,   39.9000,   19.2000,   11.1000,    6.8000,    3.9000; ...
%             100.0000,   66.3000,   29.6000,   19.0000,   11.0000,    6.8000,    4.0000 ];
%        
% % SNR         5          10         25         50         100        200        500
% Err_DBV = [  24.1000,    8.4300,    3.7300,    2.1100,    1.1600,    0.7500,    0.5800; ...
%              24.1000,    8.6200,    3.6900,    2.0100,    1.1000,    0.6400,    0.4100; ...
%               9.8500,    7.1000,    6.5200,    9.0000,   10.3000,   11.4000,   12.1000; ...
%               9.5200,    6.8400,    6.4800,    7.8000,    9.4300,    9.0800,    9.3200; ...
%               8.0300,    6.2000,    4.6900,    4.6800,    4.3600,    4.2600,    4.8800; ...
%               9.1900,    6.6800,    4.5600,    3.7200,    3.7000,    3.2800,    2.9500; ...
%             100.0000,  100.0000,  100.0000,    1.9100,    1.0500,    0.6500,    0.4200; ...
%             100.0000,  100.0000,  100.0000,    1.7700,    1.0100,    0.6700,    0.4800 ];
%          
% % SNR         5          10         25         50         100        200        500
% Err_R2p = [   8.8900,    3.0000,    1.9700,    1.8300,    1.7900,    1.7900,    1.7800; ...
%               8.8700,    3.0800,    2.1600,    1.9800,    1.9500,    1.9400,    1.9500; ...
%               4.1000,    3.2200,    2.9300,    2.7800,    2.7900,    2.7000,    2.7200; ...
%               3.9000,    3.1200,    3.2700,    3.1700,    3.1600,    3.0900,    3.1900; ...
%               3.5000,    2.2800,    1.9300,    1.9100,    1.9000,    1.8600,    1.9300; ...
%               3.7300,    2.3300,    2.1200,    2.1400,    2.1900,    2.1800,    2.1500 ];
%           
% % SNR         5          10         25         50         100        200        500
% Rel_OEF = [ 101.0000,  230.0000,  500.0000,  178.0000,  500.0000,   58.5000,   38.2000; ...
%             500.0000,  500.0000,  425.0000,  145.0000,   74.3000,   51.3000,   35.3000; ...
%             163.0000,  165.0000,  112.0000,   97.6000,   81.8000,   74.8000,   74.8000; ...
%             190.0000,  161.0000,  109.0000,   79.2000,   62.0000,   57.6000,   55.7000; ...
%             265.0000,  197.0000,  126.0000,   99.1000,   80.3000,   72.0000,   71.9000; ...
%             247.0000,  174.0000,  112.0000,   78.1000,   57.9000,   52.8000,   49.9000 ];
% 
% % SNR         5          10         25         50         100        200        500
% Rel_DBV = [ 426.0000,  293.0000,  115.0000,   54.1000,   29.7000,   16.8000,   10.3000; ...
%             425.0000,  300.0000,  116.0000,   54.7000,   28.9000,   16.3000,    8.9000; ...
%             347.0000,  224.0000,  148.0000,  146.0000,  154.0000,  161.0000,  164.0000; ...
%             320.0000,  209.0000,  135.0000,  124.0000,  137.0000,  128.0000,  125.0000; ...
%             286.0000,  197.0000,  132.0000,   91.1000,   71.1000,   61.4000,   65.5000; ...
%             295.0000,  199.0000,  116.0000,   72.8000,   62.0000,   47.3000,   38.6000 ];
% 
% % SNR         5          10         25         50         100        200        500
% Rel_R2p = [  88.3000,   56.6000,   26.4000,   20.5000,   18.2000,   17.1000,   16.7000; ...
%              88.2000,   51.9000,   28.5000,   21.6000,   19.5000,   18.6000,   18.3000; ...
%              75.9000,   52.9000,   34.6000,   27.9000,   25.3000,   24.0000,   23.0000; ...
%              73.4000,   47.8000,   34.2000,   28.5000,   27.3000,   25.2000,   24.5000; ...
%              71.9000,   44.8000,   30.1000,   22.2000,   19.6000,   18.1000,   18.2000; ...
%              81.7000,   43.3000,   29.0000,   22.7000,   21.0000,   20.0000,   19.1000 ];

   
%% Plotting SNR comparisons

% Pull out the rows we want
npr = length(plotrows);
rlabels = rnames(plotrows);


% Plot R2p Error
figure; box on; 
semilogx(SNR,abs(Err_R2p(plotrows,:)));
hold on;
ylabel('R2'' Error (%)');
xlabel('SNR');
legend(rlabels{:});
xlim([4,600]);
ylim([0, 10]);
xticks(SNR);

% Plot DBV Error
Max_DBV = 30;
% Err_DBV(abs(Err_DBV) > Max_DBV) = Max_DBV;
figure; box on;
semilogx(SNR,abs(Err_DBV(plotrows,:)));
hold on;
ylabel('DBV Error (%)');
xlabel('SNR');
legend(rlabels{:});
xlim([0,500]);
ylim([0, Max_DBV]);
xticks(SNR);

% Plot OEF Error
figure; box on;
semilogx(SNR,abs(Err_OEF(plotrows,:)));
hold on;
ylabel('OEF Error (%)');
xlabel('SNR');
legend(rlabels{:});
xlim([0,500]);
ylim([0,200]);
xticks(SNR);

% Plot Total Relative Error
% Max_Rel = 600;
% Rel_All(Err_DBV > Max_Rel) = Max_Rel;
% figure; box on;
% semilogx(SNR,Rel_All(plotrows,:));
% hold on;
% ylabel('Total Relative Error (%)');
% xlabel('SNR');
% legend(rlabels{:});
% xlim([0,500]);
% ylim([0, Max_Rel]);
% xticks(SNR);